<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 1. 리팩터링 첫 번째 예시 | VuePress Blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/blog/img/favicon.svg">
    <meta name="description" content="">
    <link rel="preload" href="/blog/assets/css/0.styles.92361acc.css" as="style"><link rel="preload" href="/blog/assets/js/app.b141fb2e.js" as="script"><link rel="preload" href="/blog/assets/js/5.e4dfb63c.js" as="script"><link rel="preload" href="/blog/assets/js/2.ba194ab3.js" as="script"><link rel="preload" href="/blog/assets/js/44.2683f171.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.2d1785dc.js"><link rel="prefetch" href="/blog/assets/js/11.85e6da0b.js"><link rel="prefetch" href="/blog/assets/js/12.3921dc86.js"><link rel="prefetch" href="/blog/assets/js/13.d3320693.js"><link rel="prefetch" href="/blog/assets/js/14.4e862b39.js"><link rel="prefetch" href="/blog/assets/js/15.8392d42f.js"><link rel="prefetch" href="/blog/assets/js/16.2687890e.js"><link rel="prefetch" href="/blog/assets/js/17.b6b151a9.js"><link rel="prefetch" href="/blog/assets/js/18.209d7da2.js"><link rel="prefetch" href="/blog/assets/js/19.fe241b95.js"><link rel="prefetch" href="/blog/assets/js/20.b813602b.js"><link rel="prefetch" href="/blog/assets/js/21.413957c1.js"><link rel="prefetch" href="/blog/assets/js/22.f930ff2c.js"><link rel="prefetch" href="/blog/assets/js/23.f19aeafa.js"><link rel="prefetch" href="/blog/assets/js/24.6ac364bc.js"><link rel="prefetch" href="/blog/assets/js/25.108192b8.js"><link rel="prefetch" href="/blog/assets/js/26.590f88f2.js"><link rel="prefetch" href="/blog/assets/js/27.4a4bd104.js"><link rel="prefetch" href="/blog/assets/js/28.2b9b03c4.js"><link rel="prefetch" href="/blog/assets/js/29.5ff1bf29.js"><link rel="prefetch" href="/blog/assets/js/3.9fb2bf29.js"><link rel="prefetch" href="/blog/assets/js/30.d8b26814.js"><link rel="prefetch" href="/blog/assets/js/31.c8b89bb6.js"><link rel="prefetch" href="/blog/assets/js/32.6d64247f.js"><link rel="prefetch" href="/blog/assets/js/33.715ff901.js"><link rel="prefetch" href="/blog/assets/js/34.d9dbd203.js"><link rel="prefetch" href="/blog/assets/js/35.57265f29.js"><link rel="prefetch" href="/blog/assets/js/36.269fb436.js"><link rel="prefetch" href="/blog/assets/js/37.cb258795.js"><link rel="prefetch" href="/blog/assets/js/38.4d5a3d22.js"><link rel="prefetch" href="/blog/assets/js/39.ae52b12f.js"><link rel="prefetch" href="/blog/assets/js/4.96d89330.js"><link rel="prefetch" href="/blog/assets/js/40.7f72fba8.js"><link rel="prefetch" href="/blog/assets/js/41.f10eb0fb.js"><link rel="prefetch" href="/blog/assets/js/42.821c9c42.js"><link rel="prefetch" href="/blog/assets/js/43.89e7af83.js"><link rel="prefetch" href="/blog/assets/js/45.6710fd48.js"><link rel="prefetch" href="/blog/assets/js/46.d37f4e3e.js"><link rel="prefetch" href="/blog/assets/js/47.d1c45acf.js"><link rel="prefetch" href="/blog/assets/js/48.ee45f8d6.js"><link rel="prefetch" href="/blog/assets/js/49.d157a92b.js"><link rel="prefetch" href="/blog/assets/js/50.bcfaa4f5.js"><link rel="prefetch" href="/blog/assets/js/51.7bf3ba0e.js"><link rel="prefetch" href="/blog/assets/js/52.328cd456.js"><link rel="prefetch" href="/blog/assets/js/53.1470df17.js"><link rel="prefetch" href="/blog/assets/js/54.d20fce4b.js"><link rel="prefetch" href="/blog/assets/js/55.e059f1d2.js"><link rel="prefetch" href="/blog/assets/js/56.285ebd8c.js"><link rel="prefetch" href="/blog/assets/js/57.f59f5ed5.js"><link rel="prefetch" href="/blog/assets/js/58.ff9dfb2d.js"><link rel="prefetch" href="/blog/assets/js/59.116eb316.js"><link rel="prefetch" href="/blog/assets/js/6.afe189b3.js"><link rel="prefetch" href="/blog/assets/js/60.405512d2.js"><link rel="prefetch" href="/blog/assets/js/61.09b3a8cf.js"><link rel="prefetch" href="/blog/assets/js/7.fdce67fc.js"><link rel="prefetch" href="/blog/assets/js/8.e4f74d2d.js"><link rel="prefetch" href="/blog/assets/js/9.9d98ba94.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.92361acc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-47eed08e><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/img/logo.png" alt="VuePress Blog" class="logo"> <span class="site-name can-hide">VuePress Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/blog/refactoring/.html" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/blog/tag/" class="nav-link">
  Tags
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/blog/refactoring/.html" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/blog/tag/" class="nav-link">
  Tags
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>리팩토링</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/refactoring/ch1.html" aria-current="page" class="active sidebar-link">Chapter 1. 리팩터링 첫 번째 예시</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/refactoring/ch1.html#_1-예시-프로그램" class="sidebar-link">1. 예시 프로그램</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/refactoring/ch1.html#_1-리팩터링-첫-단계" class="sidebar-link">1) 리팩터링 첫 단계</a></li><li class="sidebar-sub-header"><a href="/blog/refactoring/ch1.html#_2-statement-함수-쪼개기" class="sidebar-link">2) statement() 함수 쪼개기</a></li><li class="sidebar-sub-header"><a href="/blog/refactoring/ch1.html#_2-계산-단계와-포맷팅-단계-분리하기" class="sidebar-link">2. 계산 단계와 포맷팅 단계 분리하기</a></li><li class="sidebar-sub-header"><a href="/blog/refactoring/ch1.html#_3-다형성을-활용해-계산-코드-재구성-타입-코드를-서브클래스로-바꾸기-step-8" class="sidebar-link">3. 다형성을 활용해 계산 코드 재구성 (타입 코드를 서브클래스로 바꾸기) step 8</a></li></ul></li></ul></li><li><a href="/blog/refactoring/ch2.html" class="sidebar-link">Chapter 2. 리팩터링 원칙</a></li><li><a href="/blog/refactoring/ch3.html" class="sidebar-link">Chapter 3. 코드에서 나는 악취</a></li><li><a href="/blog/refactoring/ch4.html" class="sidebar-link">Chapter 4. 테스트 구축하기</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1-예시-프로그램"><a href="#_1-예시-프로그램" class="header-anchor">#</a> 1. 예시 프로그램</h2> <ul><li>프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가한다.</li> <li><a href="step1.js">step1</a></li></ul> <h3 id="_1-리팩터링-첫-단계"><a href="#_1-리팩터링-첫-단계" class="header-anchor">#</a> 1) 리팩터링 첫 단계</h3> <ul><li>리팩터링 첫 단계는 항상 똑같다. 리팩터링할 코드 영역을 꼼곰하게 검사해줄 테스트 코드를 만들어야 한다.</li> <li><strong>리팩터링하기 전에 제대로 된 테스트부터 마련하다. 테스트는 반드시 자가진단하도록 만든다.</strong></li></ul> <h3 id="_2-statement-함수-쪼개기"><a href="#_2-statement-함수-쪼개기" class="header-anchor">#</a> 2) statement() 함수 쪼개기</h3> <ul><li>switch문은 한 번의 공연에 대한 요금을 계산하고 있다.</li> <li>이러한 사실은 코드를 분석해서 얻은 정보로 이렇게 파악한 정보는 휘발성이 강하기 때문에 재빨리 코드에 반영해야 한다.</li> <li>그러면 다음에 코드를 볼 때 다시 분석하지 않아도 코드 스스로가 자신이 하는일을 알려줄 수 있다. <a href="step2.js">step2</a></li> <li><strong>리팩터링은 프로그램 수정을 작은 단계로 나눠 진행한다. 그래서 중간에 실수하더라도 버그를 쉽게 찾을 수 있다.</strong></li> <li>동적 타입 언어에선 변수명에 타입을 드러내게 하면 도움이된다. 역할이 뚜렷하지 않을 때는 부정 관사를 붙이면 좋다.</li> <li><strong>컴퓨터가 이해하는 코드는 바보도 작성할 수 있다. 사람이 이해하도록 작성하는 프로그래머가 진정한 실력자다.</strong></li></ul> <h4 id="_3-play변수-제거하기"><a href="#_3-play변수-제거하기" class="header-anchor">#</a> 3) play변수 제거하기</h4> <ul><li>amountFor()의 매개변수 중 play는 사실 performance에서 얻는거이므로 따로 전달할 필요가 없다. <a href="step3.js">step3</a></li> <li>이로인해 공연을 조회 횟수가 1번에서 3번으로 증가하였다. 그렇다고해도 성능에 큰 영향은 없다.</li> <li>설사 심각하게 느려지더라도 리팩터링된 코드베이스는 성능 개선이 수월하다.</li></ul> <blockquote><p>지역변수를 제거해서 얻는 가장 큰 장점은 유효범위를 신경 써야할 대상이 즐어들기 때문에 추출작업이 쉬워진다.</p></blockquote> <h4 id="_4-적립-포인트-계산-코드-추출"><a href="#_4-적립-포인트-계산-코드-추출" class="header-anchor">#</a> 4) 적립 포인트 계산 코드 추출</h4> <ul><li>volumeCredits은 반복문을 돌때마다 값을 누적해야하므로 volumesCredits의 복제본을 초기화해서 계산 결과를 반환하도록하는 것이 편리하다. <a href="step4.js">step4</a></li></ul> <h4 id="_5-format-변수-제거하기-volumecredits-totalamount-변수-제거-반복문-쪼개기"><a href="#_5-format-변수-제거하기-volumecredits-totalamount-변수-제거-반복문-쪼개기" class="header-anchor">#</a> 5) format 변수 제거하기, volumeCredits, totalAmount 변수 제거(반복문 쪼개기)</h4> <ul><li>임시 변수는 나중에 문제를 일으킬 수 있고, 자신이 속한 루틴에서만 의미가 있어 루틴이 길고 복잡해지기 쉽다.</li> <li>따라서 다음 리팩터링은 이런 변수들을 제거하는 것이다.</li> <li>반복문을 쪼개면 성능에 대해 걱정이 될 수 있겠지만 이 정도의 중복은 성능에 크게 영향을 미치지 않는다.</li> <li>'특별한 경우가 아니라면 일단 무시하자'. 그리고 성능이 떨어진다면 리팩터링 후 다시 성능을 개선하자.</li> <li>상황이 복잡해질 때는 아래와 같이 순서마다 커밋을 해서 문제가 발생하더라도 쉽게 복구할 수 있도록 하자.
<ul><li>반복문 쪼개기 -&gt; 문장 슬라이스하기(변수 초기화 문장을 사용 코드 앞에 위치 시킴) -&gt; 함수 추출하기 -&gt; 변수 인라인 하기</li></ul></li></ul> <h3 id="_2-계산-단계와-포맷팅-단계-분리하기"><a href="#_2-계산-단계와-포맷팅-단계-분리하기" class="header-anchor">#</a> 2. 계산 단계와 포맷팅 단계 분리하기</h3> <ul><li>지금까지는 프로그램의 논리적인 요소를 파악하기 쉽도록 코드의 구조를 보강하는데 주안점을 두고 리팩터링했다.</li> <li>리팩터링 초기 단계에서 흔히 수행하는 일로 복잡하게 얽힌 덩어리를 잘게 쪼개는 작업은 이름을 잘 짓는 일만큼 중요하다.</li> <li>이제 state()의 html 버전을 만드는 작업을 살펴보자.</li> <li>텍스트와 html 버전 모두 똑같은 함수를 사용하게 하고 싶을 때 <strong>단위 쪼개기</strong>를 이용하면 된다.</li> <li>statement()를 두 단계로 나누어서 첫 단계에서는 statement()에 필요한 데이터들을 처리하고, 두번째 단계에서 처리된 데이터를 통해 텍스트 or html로 표현하는 것이다.</li></ul> <h4 id="_6-두-단계로-분리하기"><a href="#_6-두-단계로-분리하기" class="header-anchor">#</a> 6) 두 단계로 분리하기</h4> <ul><li>renderPlainText에서는 데이터들을 표현만 해주도록하고 그전에 필요한 데이터들을 세팅해준다. <a href="step6.js">step 6</a></li></ul> <h4 id="_7-반복분을-파이프라인으로-바꾸기-js-분리-후-html-기능-만들기"><a href="#_7-반복분을-파이프라인으로-바꾸기-js-분리-후-html-기능-만들기" class="header-anchor">#</a> 7) 반복분을 파이프라인으로 바꾸기, js 분리 후 html 기능 만들기</h4> <ul><li>각각을 모듈화하였기 때문에 html 버전을 만들 때 코드의 중복없이 깔끔하게 만들 수 있게 되었다. <a href="step7">step 7</a></li></ul> <h3 id="_3-다형성을-활용해-계산-코드-재구성-타입-코드를-서브클래스로-바꾸기-step-8"><a href="#_3-다형성을-활용해-계산-코드-재구성-타입-코드를-서브클래스로-바꾸기-step-8" class="header-anchor">#</a> 3. 다형성을 활용해 계산 코드 재구성 (타입 코드를 서브클래스로 바꾸기) <a href="step8">step 8</a></h3> <ul><li>연극 장르룰 추가하고 장르마다 공연료와 적립 포인트 계산법을 다르게 지정할 기능을 추가한다면 현재 상태에서는 계산을 수행하는 함수의 조건문을 수정해야 한다.</li> <li>다형성을 활용하여 상속 계층을 구성해 각 장르별 서브 클래스가 구체적인 계산로직을 정의한다.</li> <li>이번 수정으로 나아진 점은 연극 장르별 계싼 코드들을 함께 묶은 것이다.</li> <li>이제 새로운 장르를 추가하려면 해당 장르의 서브 클래스와 생성 함수인 createPerformanceCalculator에 추가하기만 하면된다.</li></ul> <blockquote><p>좋은 코드를 가늠하는 확실한 방법은 얼마나 수정하기 쉬운가이다.</p></blockquote> <blockquote><p>리팩터링을 효과적으로 하는 핵심은, 단계를 잘게 나눠야 더 빠르게 처리할 수 있고, 코드는 절때 깨지지 않으며, 이러한 작은 단계들이 모여서 상당히 큰 변화를 이룰 수 있다는 사실을 깨닫는 것이다.</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/refactoring/ch2.html">
        Chapter 2. 리팩터링 원칙
      </a>
      →
    </span></p></div> <div id="disqus_thread" data-v-77dddae1 data-v-47eed08e></div></main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.b141fb2e.js" defer></script><script src="/blog/assets/js/5.e4dfb63c.js" defer></script><script src="/blog/assets/js/2.ba194ab3.js" defer></script><script src="/blog/assets/js/44.2683f171.js" defer></script>
  </body>
</html>
